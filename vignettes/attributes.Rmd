---
title: "Data about attributes and sources"
output: 
  rmarkdown::html_vignette:
    toc: true
vignette: >
  %\VignetteIndexEntry{attributes}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>", 
  message = FALSE,
  warning = FALSE
)
```

```{r setup, echo = FALSE}
library(DT)
library(bugphyzz)
library(dplyr)
```

```{r, echo=FALSE}
bp <- importBugphyzz(version = 'devel')
bp <- bp |> 
  filter(
    !Evidence %in% c('asr', 'inh')
  )
x <- bp |> 
  select(Attribute_source, Attribute_group, Attribute) |> 
  filter(!grepl(';', Attribute_source)) |> 
  count(Attribute_source, Attribute_group) |> 
  mutate(new_col = paste0(Attribute_group, ' (', n, ')')) |> 
  select(-Attribute_group, -n) |> 
  group_by(Attribute_source) |> 
  summarise(Attribute_group = paste(sort(new_col), collapse = '; ')) |> 
  ungroup()
```

## Attributes

Ontology terms can be searched at [OSLv3](https://www.ebi.ac.uk/ols/index) and
[OSLv4](https://www.ebi.ac.uk/ols4).

```{r, echo = FALSE}
fname <- system.file('extdata/attributes.tsv', package = 'bugphyzz')
attributes <- read.table(fname, header = TRUE, sep = '\t')
colnames(attributes) <- c(
  'Attribute', 'Attribute group', 'Validity', 'Ontoloty', 'Description'
)
datt <- datatable(
  data = attributes, 
  filter = "top",
  extensions = c("Buttons","KeyTable"), 
  options = list(
    dom = '<"top"B>lfrtip',
    buttons = list('copy', 'print'),
    iDisplayLength = 25,
    keys = TRUE,
    scrollX = TRUE,
    autoWidth = FALSE 
  )
)
datt
```

## Sources

```{r, echo = FALSE}
fname2 <- system.file(
  'extdata/attribute_sources.tsv', 
  package = 'bugphyzz', mustWork = TRUE
)
src <- read.table(
  fname2, header = TRUE, sep = '\t', quote = ""
)

src <- left_join(x, src, by = 'Attribute_source') |> 
  relocate(
    Attribute_source, Confidence_in_curation, Evidence,
    Attribute_group, full_source
  ) |> 
  mutate(
    Confidence_in_curation = factor(
      Confidence_in_curation, levels = c('high', 'medium', 'low')
    )
  ) |> 
  arrange(Confidence_in_curation, Evidence, Attribute_source)
  
colnames(src) <- c(
  'Source (short)', 'Confidence in curation', 'Evidence', 'Attribute_group',
  'Full source'
)
src_dt <- datatable(
  data = src, 
  filter = "top",
  extensions = c("Buttons","KeyTable"), 
  options = list(
    dom = '<"top"B>lfrtip',
    buttons = list('copy', 'print'),
    iDisplayLength = 25,
    keys = TRUE,
    scrollX = TRUE,
    autoWidth = FALSE 
  )
)
src_dt
## Add attribute groups and number of annotations in parenthesis
```

## Session info

```{r, echo=FALSE}
sessioninfo::session_info()
```


