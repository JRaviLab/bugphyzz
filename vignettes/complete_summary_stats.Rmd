---
title: "Complete BugPhyzz Stats"
output:
  rmarkdown::html_vignette:
    toc: yes
vignette: >
  %\VignetteIndexEntry{Complete BugPhyzz Stats}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  message = FALSE,
  warning = FALSE
)

```

```{r setup}
library(bugphyzz)
library(magrittr)
library(dplyr)
library(ggplot2)
library(plotly)
```

Load all of the bugphyzz datasets:

```{r load all datasets}
physiologies <- physiologies(keyword = "all") %>% 
  lapply(as_tibble)
```

# NCBI ID Stats

```{r}
ncbi_list <- mapply(function(.x, .y) bugphyzz:::ncbi_stats(.x, .y), physiologies, names(physiologies), SIMPLIFY = FALSE)
```
```{r warning = FALSE, echo=FALSE, out.width="45%"}
bugphyzz:::printGGlist(ncbi_list)
```

# Categorical attribute stats

## Setup

```{r fetch ranks for all unique NCBI ID}
ncbi_vec <- lapply(physiologies, function(x) x%>% select(NCBI_ID)) %>% 
  unlist() %>% 
  as.numeric() %>% 
  unique()
ncbi_vec <- ncbi_vec[!is.na(ncbi_vec)]
ranks <- bugphyzz:::ncbiRank(ncbi_vec, ranks = c("phylum", "genus", "species"))
```
```{r}
phys_ranks <- lapply(physiologies, bugphyzz:::merge_ranks, ranks = ranks)
```


```{r list of categorical physiologies}
categorical_list <- phys_ranks[c("antimicrobial resistance", "gram stain",
                                   "habitat", "aerophilicity", "extreme environment",
                                   "shape", "arrangement", "plant pathogenicity",
                                   "animal pathogen", "isolation site",
                                   "antimicrobial sensitivity", "disease association",
                                   "biofilm forming", "growth medium", "spore shape")]
```

## Number of genera per attribute of a physiology

```{r}
gen_per_attr <- mapply(function(.x, .y) bugphyzz:::num_genera_per_attribute(.x, .y), categorical_list, names(categorical_list), SIMPLIFY = FALSE)
```
```{r warning = FALSE, echo=FALSE, out.width="45%"}
bugphyzz:::printGGlist(gen_per_attr)
```

## Number of taxa without NCBI ID per attribute in physiology dataset

```{r}
taxa_without_attr <- mapply(function(.x, .y) bugphyzz:::num_taxa_without_ncbi_per_attribute(.x, .y), categorical_list, names(categorical_list), SIMPLIFY = FALSE)
```
```{r warning = FALSE, echo=FALSE, out.width="45%"}
bugphyzz:::printGGlist(taxa_without_attr)
```

## Display number of genera per phylum per attribute in physiology dataset

```{r}
attr_catalog <- mapply(function(.x, .y) bugphyzz:::attribute_catalog(.x, .y), categorical_list, names(categorical_list), SIMPLIFY = FALSE)
```
```{r warning = FALSE, echo=FALSE, out.width="45%"}
#bugphyzz:::printGGlist(attr_catalog)
#can't get attribute_catalog() to work for certain datasets that have no NA in species column
```

# Continuous attribute stats

## Setup
```{r}
continuous_list <- phys_ranks[c("growth temperature","COGEM pathogenicity rating", 
                                "optimal ph", "width", "length", 
                                "mutation rates per site per year",
                                "mutation rate per site per generation", "hydrogen gas producing",
                                "butyrate producing", "acetate producing", "lactate producing")]
```

## Display frequency of attribute

```{r}
freq <- mapply(function(.x, .y) bugphyzz:::display_freq(.x, .y), continuous_list, names(continuous_list), SIMPLIFY = FALSE)
```
```{r warning = FALSE, echo=FALSE, out.width="45%"}
bugphyzz:::printGGlist(freq)
```

## Display boxplot per phylum

```{r}
boxplots <- mapply(function(.x, .y) bugphyzz:::boxplot_per_phylum(.x, .y), continuous_list, names(continuous_list), SIMPLIFY = FALSE)
```
```{r warning = FALSE, echo=FALSE, out.width="45%"}
bugphyzz:::printGGlist(boxplots)
```
