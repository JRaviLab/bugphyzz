---
title: "bugphyzz"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{bugphyzz}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, message=FALSE}
library(bugphyzz)
library(purrr)
library(tibble)
```

## Introduction

This document shows the main functions and operations that can be used
to work with the bugphyzz datasets, such as seeing all physiologies, 
look at specific physiologies, and make signature sets.

## Installation

Bugphyzz can be installed with:

```{r, eval=FALSE}
if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager") 

BiocManager::install("waldronlab/bugphyzz")
```

## Importing datasets

The main function for importing datasets is the `physiologies` function, which
has a single argument, `keyword`, and returns a list of data.frames.
The `keyword` argument accepts a character vector specifying the name(s) 
of the dataset(s) that will be imported.

A datset with categorical attribute values:

```{r, message=FALSE}
aer <- as_tibble(physiologies("aerophilicity")[[1]])
aer
```

A dataset with numeric attribute values:

```{r}
ph <- as_tibble(physiologies('optimal ph')[[1]])
ph
```

The `physiologiesList` function can be used to display which datasets are
available through the `physiologies` function before importing them:

```{r}
physiologiesList()
```

You can use the `keyword = "all"` to import all of the datasets:

```{r, message=FALSE, eval=FALSE}
## Import all of the datasets available through the physiologies function
phys <- map(physiologies(keyword = "all"), as_tibble)
```

A separate function is provided to import the fatty acid compositions dataset,
`fattyAcidComposition`. This function takes no arguments and returns a single
data.frame object:

```{r}
fac <- as_tibble(fattyAcidComposition())
fac
```

## Creating microbial signatures

Bugphyzz provides the `makeSignatures` function to create a list of microbial
signatures from a bugphyzz dataset.

### Create signatures of an attribute with categorical/logical values:

Create a list of signatures with the NCBI taxids of microbes at the
taxonomic rank of genus. Only include microbes annotated based on
experimental data with a high frequency value. The minimum number of
microbes per signature is 10.

```{r}
aer_sig <- makeSignatures(
    aer, tax.id.type = 'NCBI_ID', tax.level = 'genus', 
    Frequency = 'always', Evidence = 'exp', min.size = 10
)
map(aer_sig, ~ head(.x, 2))
```

Number of microbes per signature:

```{r}
map_int(aer_sig, length)
```

### Create signatures of an atttribute with numerical values

Create a signature list with species of acidiphilic microbes (ph <= 4):

```{r}
acid_sig <- makeSignatures(
    df = ph, tax.id.type = 'Taxon_name', tax.level = 'species',
    max = 4
)
map(acid_sig, ~ head(.x, 2))
```

Number of microbes:

```{r}
map_int(acid_sig, length)
```

Create a signature list with species of alkaliphilic microbes (ph >= 8):

```{r}
basic_sig <- makeSignatures(
    df = ph, tax.id.type = 'Taxon_name', tax.level = 'species', 
    min = 8
)
map(basic_sig, ~ head(.x, 2))
```

Number of microbes:

```{r}
map_int(basic_sig, length)
```

## Session information:

```{r}
sessionInfo()
```
